# XV-6
## 概述

### 进程管理:
xv6 使用进程作为资源管理和任务调度的基本单位。每个进程拥有独立的内存空间，包括指令、数据和栈。内核通过页表机制为每个进程提供独立的地址空间，确保进程之间的内存隔离。进程可以通过 fork 系统调用创建子进程，使用 exec 加载新程序，并通过 exit 和 wait 进行终止和同步。这里的fork通过创建子进程轻松实现了改变标准输入输出的过程，而且保证了进程之间的独立性。
### 内存管理：
xv6 采用分页机制管理内存，每个进程都有自己的页表，将虚拟地址映射到物理地址。页表是一种特殊的数据结构，用于实现内存虚拟化，存储虚拟地址到物理地址的映射。通过这种方式，每个进程都拥有独立的内存空间，增强了进程间的隔离性。此外，页表和虚拟地址的使用提高了内存利用效率，允许将一段连续的虚拟内存映射到不连续的物理内存上。
### 调度：
xv6 实现了一个简单的进程调度器，用于在多个进程之间分配 CPU 时间。当进程等待 I/O 操作或时间片耗尽时，调度器会选择下一个可运行的进程。这种多路复用机制为每个进程提供了独占处理器的假象，提高了系统的并发性能。
### 内存分配：
xv6 的内存分配器管理物理内存页，采用链表结构维护空闲内存页。当需要分配内存时，从空闲链表中取出一个内存页；释放内存时，将内存页重新加入空闲链表。这种设计简洁高效，便于内存的分配和回收。
### 中断和异常处理：
xv6 通过中断和异常机制处理外部设备事件和程序错误。当发生中断或异常时，CPU 会切换到内核模式，执行相应的处理程序，以确保系统的稳定性和安全性。xv6 使用中断向量表来管理不同类型的中断和异常，每种类型都有对应的处理函数。
### 中断和异常处理：
xv6 通过中断和异常机制处理外部设备事件和程序错误。当发生中断或异常时，CPU 会切换到内核模式，执行相应的处理程序，以确保系统的稳定性和安全性。xv6 使用中断向量表来管理不同类型的中断和异常，每种类型都有对应的处理函数。
## 可改进方向
### 内存分配问题：
XV-6的内存分配是固定的4096字节，这体现了早期操作系统确定性优先的设计原则。它保证了硬件适配性，实时保障型和简单性。而更加智能的操作系统会根据进程的需要分配合适大小的内存空间，有效解决资源的分配与利用问题。例如，现在操作系统可以采用混合分页机制：基础层保留4KB标准页，叠加2MB大页，并按照实际需求物理分配内存空间。
### 调度
xv6 所实现的调度算法非常朴素，仅仅是让每个进程轮流执行。对此，可以进行适当改进。例如让每个进程都有优先级，并加入优先级动态调整机制，优化整体资源调度。
此外，在 wakeup 中遍历整个进程表来寻找对应 chan 的进程是非常低效的。更好的办法是用另一个结构体代替 sleep 和 wakeup 中的 chan，该结构体中维护了一个睡眠进程的链表。
